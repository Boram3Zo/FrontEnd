# ğŸ”„ ì‚°ì±…-ê²½ë¡œ-ì €ì¥-API-ì—°ë™

> **ì‘ì—… ìœ í˜•**: ê¸°ëŠ¥ ë³€ê²½/ìˆ˜ì •  
> **ì‘ì—… ë‚ ì§œ**: 2025-09-14  
> **ë‹´ë‹¹ì**: GitHub Copilot

## ğŸ“‹ ì‘ì—… ê°œìš”

### ë¬¸ì œ ìƒí™©

- `WalkSummary` ì»´í¬ë„ŒíŠ¸ì˜ "ì €ì¥í•˜ê¸°" ë²„íŠ¼ì´ ì½˜ì†” ë¡œê·¸ë§Œ ì¶œë ¥í•˜ëŠ” ì„ì‹œ ìƒíƒœì˜€ìŒ
- ì‚¬ìš©ìê°€ ì™„ë£Œí•œ ì‚°ì±… ê²½ë¡œë¥¼ ì‹¤ì œ ì„œë²„ì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ í•„ìš”í–ˆìŒ

### ìš”êµ¬ì‚¬í•­

- ì‚°ì±… ì™„ë£Œ í›„ "ì €ì¥í•˜ê¸°" ë²„íŠ¼ í´ë¦­ ì‹œ `POST /post/save-route` APIë¥¼ í˜¸ì¶œ
- ì„¸ì…˜ ë°ì´í„°(ê²½ë¡œ, ì‹œê°„, ê±°ë¦¬ ë“±)ë¥¼ API ìŠ¤í™ì— ë§ê²Œ ë³€í™˜í•˜ì—¬ ì „ì†¡
- ì €ì¥ ì¤‘ ìƒíƒœ í‘œì‹œ ë° ì„±ê³µ/ì‹¤íŒ¨ í”¼ë“œë°± ì œê³µ
- ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ì„ í†µí•œ ì‚¬ìš©ì ì‹ë³„

## ğŸ”§ ë³€ê²½ ì‚¬í•­

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼

- `app/_libs/routeService.ts` - ê²½ë¡œ ì €ì¥ API ì„œë¹„ìŠ¤

### ìˆ˜ì •ëœ íŒŒì¼

- `app/_components/walk/WalkSummary.tsx` - ì €ì¥ ë²„íŠ¼ ë¡œì§ êµ¬í˜„

### ì£¼ìš” ë³€ê²½ ë‚´ìš©

1. **routeService.saveRoute()**: ì„¸ì…˜ ë°ì´í„°ë¥¼ API ìŠ¤í™ì— ë§ëŠ” í˜ì´ë¡œë“œë¡œ ë³€í™˜ í›„ ì„œë²„ ì „ì†¡
2. **WalkSummary.handleSaveRoute()**: ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” ë¹„ë™ê¸° í•¸ë“¤ëŸ¬ êµ¬í˜„
3. **ì €ì¥ ìƒíƒœ ê´€ë¦¬**: `isSaving` stateë¥¼ í†µí•œ ì¤‘ë³µ í´ë¦­ ë°©ì§€ ë° UI í”¼ë“œë°±

### ì½”ë“œ ë³€ê²½ ì˜ˆì‹œ

#### routeService.ts (ì‹ ê·œ ìƒì„±)

```typescript
export async function saveRoute(
	session: WalkingSession,
	pins: WalkingPin[],
	memberId: number,
	title?: string,
	content?: string,
	theme?: string,
	hashtags?: string[]
): Promise<SaveRouteResponse> {
	// ì‹œì‘/ì¢…ë£Œ ì§€ì  ì¶”ì¶œ ë° í˜ì´ë¡œë“œ êµ¬ì„±
	const payload: SaveRouteRequest = {
		memberId,
		title: title || `ì‚°ì±… ê²½ë¡œ - ${new Date().toLocaleDateString()}`,
		region: startPin?.addressDetailed?.gu || startPin?.address || "ë¯¸ì§€ì •",
		duration: formatDuration(session.durationSec),
		distance: session.distanceKm,
		// ... ê¸°íƒ€ í•„ë“œë“¤
		map: {
			startLatitude: startPin?.lat.toString() || "0",
			startLongitude: startPin?.lng.toString() || "0",
			// ...
			spots: JSON.stringify(session.route || []),
		},
	};

	return await ApiClient.post<SaveRouteResponse>("/post/save-route", payload);
}
```

#### WalkSummary.tsx ì €ì¥ ë²„íŠ¼ ë³€ê²½

```typescript
// Before (ê¸°ì¡´ ì½”ë“œ)
<Button onClick={() => {
    console.log("[save] walking record saved");
}}>
    ì €ì¥í•˜ê¸°
</Button>

// After (ìˆ˜ì •ëœ ì½”ë“œ)
<Button
    onClick={handleSaveRoute}
    disabled={isSaving}
>
    {isSaving ? "ì €ì¥ ì¤‘..." : "ì €ì¥í•˜ê¸°"}
</Button>
```

## âœ… ê°œì„  íš¨ê³¼

### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

- **ì‹¤ì œ ì €ì¥ ê¸°ëŠ¥**: ì‚°ì±… ì™„ë£Œ í›„ ê²½ë¡œë¥¼ ì‹¤ì œë¡œ ì„œë²„ì— ì €ì¥ ê°€ëŠ¥
- **ì¦‰ì‹œ í”¼ë“œë°±**: ì €ì¥ ì¤‘/ì™„ë£Œ/ì‹¤íŒ¨ ìƒíƒœë¥¼ ì‚¬ìš©ìì—ê²Œ ëª…í™•íˆ í‘œì‹œ
- **ì¤‘ë³µ ë°©ì§€**: ì €ì¥ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™”ë¡œ ì¤‘ë³µ ìš”ì²­ ë°©ì§€
- **ì„±ê³µ í™•ì¸**: ì €ì¥ ì™„ë£Œ ì‹œ ìƒì„±ëœ ê²½ë¡œ IDì™€ í•¨ê»˜ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ

### ê¸°ìˆ ì  ê°œì„ 

- **API ì—°ë™**: ë°±ì—”ë“œ API ìŠ¤í™ì— ë§ëŠ” ì™„ì „í•œ ì—°ë™ êµ¬í˜„
- **íƒ€ì… ì•ˆì „ì„±**: TypeScript íƒ€ì… ì •ì˜ë¡œ API ìš”ì²­/ì‘ë‹µ êµ¬ì¡° ë³´ì¥
- **ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦**: `credentials: 'include'`ë¥¼ í†µí•œ ìë™ ì¸ì¦ ì²˜ë¦¬
- **í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°**: ì¶”í›„ ì‚¬ì§„ ì—…ë¡œë“œ, í•´ì‹œíƒœê·¸ ë“± ê¸°ëŠ¥ í™•ì¥ ìš©ì´

## ğŸ§ª í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì €ì¥ í…ŒìŠ¤íŠ¸**: ì‚°ì±… ì™„ë£Œ â†’ WalkSummary â†’ "ì €ì¥í•˜ê¸°" í´ë¦­ â†’ ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
2. **ì €ì¥ ì¤‘ ìƒíƒœ í…ŒìŠ¤íŠ¸**: ì €ì¥ ë²„íŠ¼ í´ë¦­ â†’ "ì €ì¥ ì¤‘..." í…ìŠ¤íŠ¸ ë° ë²„íŠ¼ ë¹„í™œì„±í™” í™•ì¸
3. **ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ í…ŒìŠ¤íŠ¸**: ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í™•ì¸
4. **ì„¸ì…˜ ë°ì´í„° ë³€í™˜ í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ ê²½ë¡œ ë°ì´í„°ë¡œ API í˜ì´ë¡œë“œ ì˜¬ë°”ë¥¸ ìƒì„± í™•ì¸

### í™•ì¸ ì‚¬í•­

- [x] ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ `POST /post/save-route` API í˜¸ì¶œ í™•ì¸
- [x] ì„¸ì…˜ ë°ì´í„°ê°€ API ìŠ¤í™ì— ë§ê²Œ ë³€í™˜ë˜ëŠ”ê°€?
- [x] ì €ì¥ ì¤‘/ì™„ë£Œ/ì‹¤íŒ¨ ìƒíƒœê°€ ì ì ˆíˆ í‘œì‹œë˜ëŠ”ê°€?
- [x] ì¤‘ë³µ í´ë¦­ ì‹œ ì¤‘ë³µ ìš”ì²­ì´ ë°©ì§€ë˜ëŠ”ê°€?
- [x] ê¸°ì¡´ WalkSummary í‘œì‹œ ê¸°ëŠ¥ì— ì˜í–¥ì´ ì—†ëŠ”ê°€?

### API í…ŒìŠ¤íŠ¸ í™•ì¸

```bash
# ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ í™•ì¸í•  ìš”ì²­
POST /post/save-route
Content-Type: application/json
Cookie: JSESSIONID=...

# ì˜ˆìƒ ì‘ë‹µ
{
  "success": true,
  "data": 456,
  "message": null
}
```

## ğŸ“– ì‚¬ìš©ë²•

### ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš°

1. **ì‚°ì±… ì‹œì‘**: ì‚°ì±… íŠ¸ë˜í‚¹ ì‹œì‘
2. **ì‚°ì±… ì™„ë£Œ**: ì¢…ë£Œ ë²„íŠ¼ í´ë¦­ â†’ WalkSummary í™”ë©´ ì´ë™
3. **ê²½ë¡œ ì €ì¥**: "ì €ì¥í•˜ê¸°" ë²„íŠ¼ í´ë¦­
4. **í™•ì¸**: "ì €ì¥ ì¤‘..." â†’ "ê²½ë¡œê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ID: 456)" ë©”ì‹œì§€ í™•ì¸

### ê°œë°œì ì‚¬ìš©ë²•

#### ê²½ë¡œ ì €ì¥ ì„œë¹„ìŠ¤ ì§ì ‘ í˜¸ì¶œ

```typescript
import { saveRoute } from "@/app/_libs/routeService";

// ì„¸ì…˜ê³¼ í•€ ë°ì´í„°ë¡œ ê²½ë¡œ ì €ì¥
const result = await saveRoute(walkingSession, pins, memberId, "ë‚´ ì‚°ì±… ê²½ë¡œ", "ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì¢‹ì•„ì„œ ê±¸ì—ˆì–´ìš”", "íœ´ì‹", [
	"ì‚°ì±…",
	"ìš´ë™",
	"ê±´ê°•",
]);

console.log("ì €ì¥ëœ ê²½ë¡œ ID:", result.data);
```

#### ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ í™œìš©

```typescript
// ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥
import { saveRoute } from "@/app/_libs/routeService";

const MyComponent = () => {
	const handleSave = async () => {
		try {
			const result = await saveRoute(session, pins, userId);
			// ì„±ê³µ ì²˜ë¦¬
		} catch (error) {
			// ì—ëŸ¬ ì²˜ë¦¬
		}
	};
};
```

## ğŸ”— ê´€ë ¨ ë§í¬

- API ë¬¸ì„œ: `POST /post/save-route` ìŠ¤í™
- ê´€ë ¨ ì»´í¬ë„ŒíŠ¸: `WalkSummary.tsx`, `useWalkTracker.ts`
- ì´ì „ ì‘ì—…: ì‚¬ì§„ ì—…ë¡œë“œ API ì—°ë™ (`POST /post/upload-photo`)

## ğŸ“ ë¹„ê³ 

### í˜„ì¬ ì œí•œì‚¬í•­

- `memberId`ëŠ” ì„ì‹œê°’(1) ì‚¬ìš© ì¤‘ â†’ ì‹¤ì œ ì¸ì¦ëœ ì‚¬ìš©ì IDë¡œ ë³€ê²½ í•„ìš”
- `photoList`ëŠ” ê¸°ë³¸ êµ¬ì¡°ë§Œ êµ¬í˜„ â†’ ì‹¤ì œ ì‚¬ì§„ ì—…ë¡œë“œ APIì™€ ì—°ë™ í•„ìš”
- í•´ì‹œíƒœê·¸, í…Œë§ˆ ì„ íƒì€ ê¸°ë³¸ê°’ ì‚¬ìš© â†’ ì‚¬ìš©ì ì…ë ¥ UI ì¶”ê°€ ê°€ëŠ¥

### í–¥í›„ ê°œì„  ë°©í–¥

1. **ì¸ì¦ ì—°ë™**: `useAuth` í›…ì—ì„œ ì‹¤ì œ ì‚¬ìš©ì ID ì¶”ì¶œ
2. **ì‚¬ì§„ í†µí•©**: ì‚¬ì§„ ì—…ë¡œë“œ í›„ í•´ë‹¹ ë©”íƒ€ë°ì´í„°ë¥¼ `photoList`ì— í¬í•¨
3. **UI ê°œì„ **: ì €ì¥ ì„±ê³µ í›„ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ ë˜ëŠ” ê³µìœ  ì˜µì…˜ ì œê³µ
4. **ì˜¤í”„ë¼ì¸ ì§€ì›**: ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ì €ì¥ í›„ ë‚˜ì¤‘ì— ë™ê¸°í™”
5. **í…ŒìŠ¤íŠ¸ ì¶”ê°€**: `routeService.test.ts` ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±

### API ì‘ë‹µ ì²˜ë¦¬ ì°¸ê³ 

```typescript
// ì„±ê³µ ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": 456,
  "message": null
}

// ì‹¤íŒ¨ ì‘ë‹µ ì˜ˆì‹œ
{
  "success": false,
  "data": null,
  "message": "ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
}
```
