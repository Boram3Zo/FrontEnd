# 🔄 로그인-디버깅-로그-추가

> **작업 유형**: 기능 변경/수정  
> **작업 날짜**: 2025-09-14  
> **담당자**: mjki

## 📋 작업 개요

### 문제 상황

백엔드에서 로그인 시 다음과 같은 에러 로그가 발생:

```
[LOGIN] 로그인 시도 - email=null
[LOGIN] 입력값 누락 - email=null, passwordNull=true
```

프론트엔드에서 정상적으로 데이터를 전송하는 것으로 보이지만, 백엔드에서 `null` 값을 받고 있어 원인 파악이 필요함.

### 요구사항

- 로그인 폼의 입력값이 올바르게 수집되는지 확인
- API 요청 시 전송되는 데이터의 형태와 내용 검증
- 백엔드가 받는 실제 요청 body 구조 파악
- 디버깅을 위한 상세 로그 추가

## 🔧 변경 사항

### 수정된 파일

- `app/_libs/apiClient.ts` - API 요청 상세 로그 추가
- `app/_hooks/useLoginForm.ts` - 폼 입력값 및 전송 데이터 로깅
- `app/_components/ui/FormField.tsx` - input name 속성 추가

### 주요 변경 내용

1. **ApiClient.request()**: API 요청 상세 정보와 JSON body 파싱 결과 로깅
2. **useLoginForm.handleInputChange()**: 입력 필드 변경 시 실시간 로깅
3. **useLoginForm.handleSubmit()**: 로그인 시도 시 전송 데이터 검증 로그
4. **FormField 컴포넌트**: Input에 name 속성 추가로 폼 바인딩 개선

### 코드 변경 예시

#### 1. ApiClient - 상세 요청 로깅

```typescript
// Before (기존 코드)
try {
	console.log("🚀 API Request:", {
		url,
		method: config.method || "GET",
		headers: config.headers,
		body: config.body,
	});

	const response = await fetch(url, config);
}

// After (수정된 코드)
try {
	// 디버깅용 로깅 (더 상세하게)
	console.log("🚀 API Request Details:", {
		url,
		method: config.method || "GET",
		headers: config.headers,
		rawBody: config.body,
		bodyType: typeof config.body,
	});

	// JSON 파싱하여 실제 데이터 확인
	if (config.body && typeof config.body === 'string') {
		try {
			const parsedBody = JSON.parse(config.body);
			console.log("📋 Parsed Body Data:", parsedBody);
		} catch {
			console.warn("⚠️ Body는 JSON이 아닙니다:", config.body);
		}
	}

	const response = await fetch(url, config);
}
```

#### 2. useLoginForm - 입력값 추적

```typescript
// Before (기존 코드)
const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
	const { id, value } = e.target;
	setFormData(prev => ({
		...prev,
		[id]: value,
	}));
};

// After (수정된 코드)
const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
	const { id, value } = e.target;
	console.log("🔄 Input Change:", { id, value }); // 디버깅용 로그
	setFormData(prev => {
		const newData = {
			...prev,
			[id]: value,
		};
		console.log("📝 Updated Form Data:", newData); // 디버깅용 로그
		return newData;
	});
};
```

#### 3. FormField - name 속성 추가

```tsx
// Before (기존 코드)
<Input
	id={id}
	type={type}
	placeholder={placeholder}
	className="h-12"
	value={value}
	onChange={onChange}
	disabled={disabled}
	required={required}
/>

// After (수정된 코드)
<Input
	id={id}
	name={id}  // name 속성 추가
	type={type}
	placeholder={placeholder}
	className="h-12"
	value={value}
	onChange={onChange}
	disabled={disabled}
	required={required}
/>
```

## ✅ 개선 효과

### 사용자 경험 개선

- **빠른 문제 해결**: 로그인 실패 시 정확한 원인 파악 가능
- **투명한 디버깅**: 개발자가 실시간으로 데이터 흐름 확인 가능
- **안정성 향상**: 폼 바인딩 개선으로 데이터 손실 방지

### 기술적 개선

- **디버깅 효율성 향상**: 상세한 로그로 API 요청/응답 추적 가능
- **데이터 투명성**: JSON 파싱 결과 확인으로 정확한 데이터 전송 검증
- **폼 안정성**: name 속성 추가로 브라우저 호환성 및 접근성 개선
- **문제 격리**: 클라이언트/서버 간 데이터 불일치 지점 명확화

## 🧪 테스트

### 테스트 시나리오

1. **입력 필드 테스트**: 이메일/비밀번호 입력 시 실시간 로그 확인
2. **API 요청 테스트**: 로그인 시도 시 전송되는 데이터 구조 검증
3. **에러 시나리오**: 빈 값, 잘못된 형식 등의 경우 로그 동작 확인

### 확인 사항

- [x] 입력 필드 변경 시 로그가 올바르게 출력되는가?
- [x] API 요청 시 JSON 파싱이 정상적으로 작동하는가?
- [x] 폼 데이터가 실시간으로 업데이트되는가?
- [x] 기존 로그인 기능에 영향이 없는가?

### 디버깅 로그 예시

브라우저 콘솔에서 다음과 같은 로그를 확인할 수 있습니다:

```javascript
🔄 Input Change: { id: "email", value: "test@example.com" }
📝 Updated Form Data: { email: "test@example.com", password: "" }
🔄 Input Change: { id: "password", value: "password123" }
📝 Updated Form Data: { email: "test@example.com", password: "password123" }
📤 Login Attempt: { email: "test@example.com", password: "password123", emailLength: 16, passwordLength: 11 }
🚀 API Request Details: { url: "http://localhost:9988/member/login", method: "POST", headers: {...}, bodyType: "string" }
📋 Parsed Body Data: { email: "test@example.com", password: "password123" }
```

## 📖 사용법

### 디버깅 로그 활용 방법

1. **브라우저 개발자 도구 열기**: F12 또는 우클릭 → 검사
2. **Console 탭 이동**: 로그 출력 확인
3. **로그인 페이지 접속**: `/login` 경로로 이동
4. **입력 테스트**: 이메일과 비밀번호 입력하며 로그 관찰
5. **로그인 시도**: 제출 버튼 클릭하여 API 요청 로그 확인

### 문제 해결 가이드

로그를 통해 다음과 같은 문제들을 진단할 수 있습니다:

```javascript
// 1. 입력값이 올바르게 수집되지 않는 경우
🔄 Input Change: { id: "email", value: "" } // ← 빈 값 확인

// 2. 폼 데이터가 업데이트되지 않는 경우
📝 Updated Form Data: { email: "", password: "" } // ← 상태 미변경

// 3. API 요청이 잘못된 데이터를 전송하는 경우
📋 Parsed Body Data: { email: null, password: undefined } // ← null/undefined 확인

// 4. Content-Type 문제
🚀 API Request Details: { headers: { "Content-Type": "text/plain" } } // ← 잘못된 헤더
```

## 🔗 관련 링크

- API 클라이언트 문서: `docs/changes/2025-09-14-1522-api-content-type-에러-해결.md`
- 로그인 폼 컴포넌트: `app/_components/auth/LoginForm.tsx`
- 로그인 훅: `app/_hooks/useLoginForm.ts`
- API 서비스: `app/_libs/authService.ts`

## 📝 비고

- **주의사항**:
  - 디버깅 로그는 개발 환경에서만 사용하고, 프로덕션 배포 시 제거 필요
  - 비밀번호 등 민감한 정보가 로그에 노출될 수 있으므로 주의
- **향후 개선 방향**:

  - 환경변수를 통한 로그 레벨 제어 기능 추가
  - 민감한 데이터 마스킹 기능 구현
  - 로그 수집 및 모니터링 시스템 연동

- **문제 해결 결과**:
  - 이 디버깅 로그를 통해 백엔드의 `email=null` 문제 원인 파악 예정
  - 클라이언트-서버 간 데이터 불일치 지점 명확화 가능
